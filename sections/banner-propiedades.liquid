{% comment %}
  Sección: Hero búsqueda propiedades (sin campo de ubicación)
  Redirige a: /collections/todos-los-inmuebles usando filtros 'collection' y 'type'
{% endcomment %}

<section class="hero-search-wrapper-{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="hero-search-bg">
    {% if section.settings.background_image != blank %}
      <img
        src="{{ section.settings.background_image | img_url: '2048x' }}"
        srcset="{
          { section.settings.background_image | img_url: '600x' } 600w,
          { section.settings.background_image | img_url: '1000x' } 1000w,
          { section.settings.background_image | img_url: '2048x' } 2048w
        }"
        sizes="(max-width: 600px) 100vw, 50vw"
        alt="{{ section.settings.heading | escape }}"
        loading="lazy"
      >
    {% endif %}
    <div class="hero-search-overlay"></div>
  </div>

  <div class="hero-search-content">
    {% if section.settings.heading != blank %}
      <h1 class="hero-search-heading">{{ section.settings.heading }}</h1>
    {% endif %}

    {% if section.settings.subheading != blank %}
      <p class="hero-search-subheading">{{ section.settings.subheading }}</p>
    {% endif %}

    <form
      class="hero-search-form"
      action="/collections/todos-los-inmuebles"
      method="get"
      data-section-id="{{ section.id }}"
      novalidate
    >
      <label class="hero-search-label visually-hidden" for="venta-select-{{ section.id }}">
        {{ section.settings.label_venta_default }}
      </label>
      <select
        name="collection"
        id="venta-select-{{ section.id }}"
        aria-label="{{ section.settings.label_venta_default | escape }}"
      >
        <option value="" disabled selected>{{ section.settings.label_venta_default }}</option>
        <option value="todos-los-inmuebles">Todos los inmuebles</option>
        <option value="venta">Venta</option>
        <option value="renta">Renta</option>
      </select>

      <label class="hero-search-label visually-hidden" for="tipo-select-{{ section.id }}">
        {{ section.settings.label_tipo_default }}
      </label>
      <select
        name="type"
        id="tipo-select-{{ section.id }}"
        aria-label="{{ section.settings.label_tipo_default | escape }}"
      >
        <option value="" disabled selected>{{ section.settings.label_tipo_default }}</option>

        {% if section.settings.option_tipo_1_label != blank %}
          <option value="{{ section.settings.option_tipo_1_label }}">
            {{ section.settings.option_tipo_1_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_2_label != blank %}
          <option value="{{ section.settings.option_tipo_2_label }}">
            {{ section.settings.option_tipo_2_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_3_label != blank %}
          <option value="{{ section.settings.option_tipo_3_label }}">
            {{ section.settings.option_tipo_3_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_4_label != blank %}
          <option value="{{ section.settings.option_tipo_4_label }}">
            {{ section.settings.option_tipo_4_label }}
          </option>
        {% endif %}
      </select>

      <button type="submit" class="hero-search-button">
        {{ section.settings.boton_texto }}
      </button>
    </form>
  </div>
</section>

<script>
  (function () {
    // Escucha el submit del formulario y deja que el navegador haga el GET
    document.addEventListener("DOMContentLoaded", function () {
      const forms = document.querySelectorAll(
        `.hero-search-form[data-section-id="${window.Shopify?.section?.id ?? ''}"]`
      );
      forms.forEach(function(form) {
        form.addEventListener("submit", handleSearch);
      });
    });

    function handleSearch(event) {
      const form = event.target;
      const sectionId = form.dataset.sectionId;
      if (!sectionId) return true;

      const ventaEl = document.getElementById(`venta-select-${sectionId}`);
      const tipoEl  = document.getElementById(`tipo-select-${sectionId}`);

      const venta = (ventaEl?.value || '').trim();
      const tipo  = (tipoEl?.value  || '').trim();

      // Puedes descomentar si quieres hacer tracking sin otorgar botón
      /*
      if (typeof gtag !== 'undefined') {
        gtag('event', 'hero_search_start', {venta, tipo});
      }
      if (typeof fbq !== 'undefined') {
        fbq('trackCustom', 'HeroPropertySearch', {venta, tipo});
      }
      */

      return true;
    }
  })();
</script>

<style>
  .hero-search-wrapper-{{ section.id }} {
    position: relative;
    overflow: hidden;
    min-height: {{ section.settings.altura_desktop }}vh;
    color: #ffffff;
    --search-bg: rgba(255, 255, 255, 0.95);
    --input-font-size: 14px;
    --button-bg: {{ section.settings.button_color }};
    --button-color: {{ section.settings.button_text_color }};
    --input-color: {{ section.settings.search_text_color }};
  }

  .hero-search-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
    background-color: #111;
  }

  .hero-search-bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    background-size: cover;
  }

  .hero-search-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, {{ section.settings.overlay_intensity }});
  }

  .hero-search-content {
    position: relative;
    z-index: 2;
    max-width: 1000px;
    margin: 0 auto;
    padding: 80px 16px;
    text-align: center;
  }

  .hero-search-heading {
    margin: 0 0 10px 0;
    font-size: {{ section.settings.heading_size }}px;
    font-weight: 700;
    color: {{ section.settings.heading_color }};
  }

  .hero-search-subheading {
    margin: 0 0 20px 0;
    font-size: {{ section.settings.subheading_size }}px;
    opacity: 0.9;
  }

  .hero-search-form {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 0;
    background: var(--search-bg);
    border-radius: 999px;
    overflow: hidden;
    max-width: 650px;
    margin: 0 auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  .hero-search-form select {
    border: none;
    padding: 12px 14px;
    font-size: var(--input-font-size);
    outline: none;
    color: var(--input-color);
    background: #ffffff;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    cursor: pointer;
    width: 100%;
  }

  .hero-search-form select ~ select {
    border-left: 1px solid #e0e0e0;
  }

  .hero-search-button {
    border: none;
    padding: 0 24px;
    font-size: var(--input-font-size);
    font-weight: 600;
    cursor: pointer;
    background: var(--button-bg);
    color: var(--button-color);
    white-space: nowrap;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  .hero-search-button:hover,
  .hero-search-button:focus,
  .hero-search-button:active {
    filter: brightness(0.9);
  }

  .visually-hidden {
    position: absolute;
    overflow: hidden;
    clip: rect(0 0 0 0);
    width: 1px;
    height: 1px;
    margin: -1px;
    padding: 0;
    border: 0;
    white-space: nowrap;
  }

  /* Mobile */
  @media (max-width: 600px) {
    .hero-search-wrapper-{{ section.id }} {
      min-height: {{ section.settings.altura_mobile }}vh;
    }

    .hero-search-content {
      padding: 50px 12px 30px;
    }

    .hero-search-heading {
      font-size: {{ section.settings.heading_size_mobile }}px;
    }

    .hero-search-subheading {
      font-size: {{ section.settings.subheading_size_mobile }}px;
    }

    .hero-search-form {
      grid-template-columns: 1fr;
      border-radius: 16px;
      max-width: 100%;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .hero-search-form select {
      border-top: none;
      border-left: none;
      border-right: none;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 0;
    }

    .hero-search-form select:first-child {
      border-bottom: 1px solid #e0e0e0;
    }

    .hero-search-button {
      border-radius: 0 0 16px 16px;
      padding: 12px 14px;
      width: 100%;
      box-shadow: none;
    }
  }
</style>

{% schema %}
{
  "name": "Hero búsqueda propiedades",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Imagen de fondo"
    },
    {
      "type": "range",
      "id": "overlay_intensity",
      "label": "Intensidad overlay",
      "min": 0,
      "max": 0.9,
      "step": 0.1,
      "default": 0.4
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Título",
      "default": "Busca tu propiedad ideal"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subtítulo",
      "default": "Encuentra casas, departamentos, terrenos y bodegas en las mejores ubicaciones."
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Tamaño título (desktop)",
      "min": 24,
      "max": 72,
      "step": 2,
      "unit": "px",
      "default": 44
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "label": "Tamaño título (móvil)",
      "min": 18,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Color título",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Tamaño subtítulo (desktop)",
      "min": 12,
      "max": 28,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "range",
      "id": "subheading_size_mobile",
      "label": "Tamaño subtítulo (móvil)",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Select Venta / Renta"
    },
    {
      "type": "text",
      "id": "label_venta_default",
      "label": "Label default",
      "default": "Venta / Renta"
    },
    {
      "type": "text",
      "id": "option_venta_1_label",
      "label": "Opción 1 label",
      "default": "Venta"
    },
    {
      "type": "text",
      "id": "option_venta_2_label",
      "label": "Opción 2 label",
      "default": "Renta"
    },

    {
      "type": "header",
      "content": "Select Tipo de inmueble"
    },
    {
      "type": "text",
      "id": "label_tipo_default",
      "label": "Label default",
      "default": "Tipo de inmueble"
    },
    {
      "type": "text",
      "id": "option_tipo_1_label",
      "label": "Tipo 1 label",
      "default": "Casa"
    },
    {
      "type": "text",
      "id": "option_tipo_2_label",
      "label": "Tipo 2 label",
      "default": "Departamento"
    },
    {
      "type": "text",
      "id": "option_tipo_3_label",
      "label": "Tipo 3 label"
    },
    {
      "type": "text",
      "id": "option_tipo_3_value",
      "label": "Tipo 3 value"
    },
    {
      "type": "text",
      "id": "option_tipo_4_label",
      "label": "Tipo 4 label"
    },
    {
      "type": "text",
      "id": "option_tipo_4_value",
      "label": "Tipo 4 value"
    },

    {
      "type": "header",
      "content": "Botón y colores"
    },
    {
      "type": "text",
      "id": "boton_texto",
      "label": "Texto botón",
      "default": "Buscar"
    },
    {
      "type": "color",
      "id": "search_text_color",
      "label": "Color texto selects",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Color botón",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Color texto botón",
      "default": "#ffffff"
    },

    {
      "type": "header",
      "content": "Alturas"
    },
    {
      "type": "range",
      "id": "altura_desktop",
      "label": "Altura (desktop)",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "range",
      "id": "altura_mobile",
      "label": "Altura (móvil)",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 65
    }
  ],
  "presets": [
    {
      "name": "Hero búsqueda propiedades (sin ubicación)"
    }
  ]
}
{% endschema %}
