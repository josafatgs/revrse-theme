{% comment %}
  Sección: Hero con barra de búsqueda de propiedades - Versión optimizada para móvil
{% endcomment %}

<section class="hero-search-wrapper-{{ section.id }}">
  <div class="hero-search-bg">
    {% if section.settings.background_image != blank %}
      <img
        src="{{ section.settings.background_image | image_url: width: 2000 }}"
        alt="{{ section.settings.heading | escape }}"
      >
    {% endif %}
    <div class="hero-search-overlay"></div>
  </div>

  <div class="hero-search-content">
    {% if section.settings.heading != blank %}
      <h1 class="hero-search-heading">{{ section.settings.heading }}</h1>
    {% endif %}

    {% if section.settings.subheading != blank %}
      <p class="hero-search-subheading">{{ section.settings.subheading }}</p>
    {% endif %}

    <form
      class="hero-search-form"
      action="{{ section.settings.form_action | default: '/collections/all' }}"
      method="get"
      data-section-id="{{ section.id }}"
      onsubmit="return handleSearch(event, this)"
    >
      <!-- Select Venta / Renta -->
      <select
        name="{{ section.settings.param_venta | default: 'venta' }}"
        id="venta-select-{{ section.id }}"
        aria-label="{{ section.settings.label_venta_default | escape }}"
      >
        <option value="">{{ section.settings.label_venta_default }}</option>

        {% if section.settings.option_venta_1_label != blank %}
          <option value="{{ section.settings.option_venta_1_value }}">
            {{ section.settings.option_venta_1_label }}
          </option>
        {% endif %}

        {% if section.settings.option_venta_2_label != blank %}
          <option value="{{ section.settings.option_venta_2_value }}">
            {{ section.settings.option_venta_2_label }}
          </option>
        {% endif %}
      </select>

      <!-- Select Tipo de inmueble -->
      <select
        name="{{ section.settings.param_tipo | default: 'tipo' }}"
        id="tipo-select-{{ section.id }}"
        aria-label="{{ section.settings.label_tipo_default | escape }}"
      >
        <option value="">{{ section.settings.label_tipo_default }}</option>

        {% if section.settings.option_tipo_1_label != blank %}
          <option value="{{ section.settings.option_tipo_1_value }}">
            {{ section.settings.option_tipo_1_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_2_label != blank %}
          <option value="{{ section.settings.option_tipo_2_value }}">
            {{ section.settings.option_tipo_2_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_3_label != blank %}
          <option value="{{ section.settings.option_tipo_3_value }}">
            {{ section.settings.option_tipo_3_label }}
          </option>
        {% endif %}

        {% if section.settings.option_tipo_4_label != blank %}
          <option value="{{ section.settings.option_tipo_4_value }}">
            {{ section.settings.option_tipo_4_label }}
          </option>
        {% endif %}
      </select>

      <!-- Campo texto (sin "buscar por ubicación") -->
      <input
        type="search"
        name="{{ section.settings.param_busqueda | default: 'q' }}"
        id="search-input-{{ section.id }}"
        placeholder="{{ section.settings.placeholder_busqueda }}"
        autocomplete="off"
        aria-label="{{ section.settings.placeholder_busqueda | escape }}"
      >

      <!-- Botón -->
      <button type="submit" class="hero-search-button">
        {{ section.settings.boton_texto }}
      </button>
    </form>
  </div>
</section>

<script>
function handleSearch(event, form) {
  var sectionId = form.getAttribute('data-section-id') || '';

  var ventaEl = document.getElementById('venta-select-' + sectionId);
  var tipoEl  = document.getElementById('tipo-select-' + sectionId);
  var qEl     = document.getElementById('search-input-' + sectionId);

  var venta = ventaEl ? ventaEl.value : '';
  var tipo  = tipoEl ? tipoEl.value : '';
  var q     = qEl ? qEl.value.trim() : '';

  // Si está todo vacío, redirige al action para evitar submit "en blanco".
  if (!venta && !tipo && !q) {
    window.location.href = form.action || '/collections/all';
    return false;
  }

  return true;
}
</script>

<style>
  .hero-search-wrapper-{{ section.id }} {
    position: relative;
    overflow: hidden;
    min-height: {{ section.settings.altura_desktop }}vh;
    color: #ffffff;
  }

  .hero-search-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }

  .hero-search-bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .hero-search-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, {{ section.settings.overlay_intensity }});
  }

  .hero-search-content {
    position: relative;
    z-index: 2;
    max-width: 1000px;
    margin: 0 auto;
    padding: 80px 16px;
    text-align: center;
  }

  .hero-search-heading {
    margin: 0 0 10px;
    font-size: {{ section.settings.heading_size }}px;
    font-weight: 700;
    color: {{ section.settings.heading_color }};
  }

  .hero-search-subheading {
    margin: 0 0 20px;
    font-size: {{ section.settings.subheading_size }}px;
    opacity: 0.9;
  }

  .hero-search-form {
    display: grid;
    grid-template-columns: 1fr 1fr 2fr auto;
    gap: 0;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 999px;
    overflow: hidden;
    max-width: 900px;
    margin: 0 auto;
  }

  .hero-search-form select,
  .hero-search-form input {
    border: none;
    padding: 12px 14px;
    font-size: 14px;
    outline: none;
    color: {{ section.settings.search_text_color }};
    background: #ffffff;
  }

  .hero-search-form select {
    border-right: 1px solid #e0e0e0;
  }

  .hero-search-form input::placeholder {
    color: {{ section.settings.search_placeholder_color }};
  }

  .hero-search-button {
    border: none;
    padding: 0 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: {{ section.settings.button_color }};
    color: {{ section.settings.button_text_color }};
    white-space: nowrap;
    transition: all 0.2s ease;
  }

  .hero-search-button:hover,
  .hero-search-button:active {
    filter: brightness(0.9);
    transform: translateY(-1px);
  }

  @media (max-width: 900px) {
    .hero-search-wrapper-{{ section.id }} {
      min-height: {{ section.settings.altura_mobile }}vh;
    }

    .hero-search-form {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      border-radius: 20px;
      gap: 1px;
    }

    .hero-search-form input {
      grid-column: 1 / -1;
      border-top: 1px solid #e0e0e0;
      padding: 16px 16px;
    }

    .hero-search-button {
      grid-column: 1 / -1;
      padding: 16px 0;
      border-radius: 0 0 20px 20px;
      font-size: 16px;
      transform: none;
    }
  }

  @media (max-width: 600px) {
    .hero-search-heading {
      font-size: {{ section.settings.heading_size_mobile }}px;
    }

    .hero-search-subheading {
      font-size: {{ section.settings.subheading_size_mobile }}px;
    }

    .hero-search-content {
      padding: 50px 12px 30px;
    }

    .hero-search-form {
      grid-template-columns: 1fr;
      border-radius: 16px;
      max-width: 100%;
    }

    .hero-search-form select,
    .hero-search-form input,
    .hero-search-button {
      border-radius: 0;
      border-bottom: 1px solid #e0e0e0;
      padding: 18px 16px;
      font-size: 16px;
    }

    .hero-search-button {
      border-bottom: none;
      border-radius: 0 0 16px 16px;
    }
  }
</style>

{% schema %}
{
  "name": "Hero búsqueda propiedades",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Imagen de fondo"
    },
    {
      "type": "range",
      "id": "altura_desktop",
      "label": "Altura en desktop (vh)",
      "min": 40,
      "max": 100,
      "step": 5,
      "default": 70
    },
    {
      "type": "range",
      "id": "altura_mobile",
      "label": "Altura en móvil (vh)",
      "min": 40,
      "max": 90,
      "step": 5,
      "default": 65
    },
    {
      "type": "range",
      "id": "overlay_intensity",
      "label": "Intensidad del overlay (0.0 a 0.9)",
      "min": 0,
      "max": 0.9,
      "step": 0.1,
      "default": 0.3
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Título",
      "default": "Encuentra tu propiedad ideal"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subtítulo",
      "default": "Filtra por operación, tipo y palabra clave"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Tamaño título (desktop)",
      "min": 24,
      "max": 72,
      "step": 2,
      "default": 44
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "label": "Tamaño título (móvil)",
      "min": 18,
      "max": 48,
      "step": 2,
      "default": 32
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Color título",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Tamaño subtítulo (desktop)",
      "min": 12,
      "max": 28,
      "step": 1,
      "default": 18
    },
    {
      "type": "range",
      "id": "subheading_size_mobile",
      "label": "Tamaño subtítulo (móvil)",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16
    },
    {
      "type": "url",
      "id": "form_action",
      "label": "URL destino del formulario",
      "default": "/collections/all"
    },

    {
      "type": "text",
      "id": "param_venta",
      "label": "Nombre parámetro Venta/Renta (query param)",
      "default": "venta"
    },
    {
      "type": "text",
      "id": "label_venta_default",
      "label": "Label opción default Venta/Renta",
      "default": "Venta / Renta"
    },
    {
      "type": "text",
      "id": "option_venta_1_label",
      "label": "Opción venta 1 (texto)",
      "default": "Venta"
    },
    {
      "type": "text",
      "id": "option_venta_1_value",
      "label": "Opción venta 1 (valor)",
      "default": "venta"
    },
    {
      "type": "text",
      "id": "option_venta_2_label",
      "label": "Opción venta 2 (texto)",
      "default": "Renta"
    },
    {
      "type": "text",
      "id": "option_venta_2_value",
      "label": "Opción venta 2 (valor)",
      "default": "renta"
    },

    {
      "type": "text",
      "id": "param_tipo",
      "label": "Nombre parámetro Tipo (query param)",
      "default": "tipo"
    },
    {
      "type": "text",
      "id": "label_tipo_default",
      "label": "Label opción default Tipo",
      "default": "Tipo de inmueble"
    },
    {
      "type": "text",
      "id": "option_tipo_1_label",
      "label": "Opción tipo 1 (texto)",
      "default": "Casa"
    },
    {
      "type": "text",
      "id": "option_tipo_1_value",
      "label": "Opción tipo 1 (valor)",
      "default": "casa"
    },
    {
      "type": "text",
      "id": "option_tipo_2_label",
      "label": "Opción tipo 2 (texto)",
      "default": "Departamento"
    },
    {
      "type": "text",
      "id": "option_tipo_2_value",
      "label": "Opción tipo 2 (valor)",
      "default": "departamento"
    },
    {
      "type": "text",
      "id": "option_tipo_3_label",
      "label": "Opción tipo 3 (texto)",
      "default": "terreno"
    },
    {
      "type": "text",
      "id": "option_tipo_3_value",
      "label": "Opción tipo 3 (valor)",
      "default": "terreno"
    },
    {
      "type": "text",
      "id": "option_tipo_4_label",
      "label": "Opción tipo 4 (texto)",
      "default": "bodega"
    },
    {
      "type": "text",
      "id": "option_tipo_4_value",
      "label": "Opción tipo 4 (valor)",
      "default": "bodega"
    },

    {
      "type": "text",
      "id": "param_busqueda",
      "label": "Nombre parámetro de búsqueda (query param)",
      "default": "q"
    },
    {
      "type": "text",
      "id": "placeholder_busqueda",
      "label": "Placeholder del campo de búsqueda",
      "default": "Buscar propiedades…"
    },

    {
      "type": "text",
      "id": "boton_texto",
      "label": "Texto del botón",
      "default": "Buscar"
    },

    {
      "type": "color",
      "id": "search_text_color",
      "label": "Color texto inputs",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "search_placeholder_color",
      "label": "Color placeholder",
      "default": "#777777"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Color botón",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Color texto botón",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Hero búsqueda propiedades"
    }
  ]
}
{% endschema %}
